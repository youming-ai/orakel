# Docker Compose for Development
# This configuration is optimized for local development with:
# - Hot-reload for web frontend
# - Volume mounting for live code changes
# - Exposed ports for debugging
# - Separate services for easier development

services:
  # Bot Service (Development Mode)
  bot:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - BUILD_UID=${UID:-1000}
        - BUILD_GID=${GID:-1000}
    image: orakel:dev
    container_name: orakel-bot-dev
    env_file:
      - .env
    environment:
      - PAPER_MODE=${PAPER_MODE:-true}
      - LOG_LEVEL=${LOG_LEVEL:-debug}
      - API_PORT=9999
    ports:
      - "9999:9999"
    volumes:
      # Mount source code for hot-reload (not production optimized)
      - ./src:/app/src:ro
      - ./data:/app/data
      - ./config.json:/app/config.json:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:9999/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

  # Web Dashboard (Development Mode)
  web:
    build:
      context: ./web
      dockerfile: Dockerfile.dev
    image: orakel-web:dev
    container_name: orakel-web-dev
    environment:
      - API_URL=http://bot:9999
    ports:
      - "9998:9998"
    volumes:
      # Mount source for Vite HMR
      - ./web/src:/app/src
      - ./web/index.html:/app/index.html
      - ./web/vite.config.ts:/app/vite.config.ts
      - ./web/tsconfig.json:/app/tsconfig.json
      - ./web/package.json:/app/package.json
    depends_on:
      - bot
    restart: unless-stopped

  # Optional: Database viewer (sqlite-web)
  # Uncomment to enable database inspection UI
  # db-viewer:
  #   image: coleifer/sqlite-web
  #   container_name: orakel-db-viewer
  #   ports:
  #     - "8080:8080"
  #   volumes:
  #     - ./data:/data
  #   command: sqlite_web /data/orakel.db -H 0.0.0.0 -P 8080 --readonly
  #   restart: unless-stopped

volumes:
  data:
